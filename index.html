<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>模板</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="src/css/component.css" />
	</head>

	<body>
		<style type="text/css">
			#top {
				position: fixed;
				left: 0;
				top: 0;
			}
			
			#bottom {
				position: fixed;
				left: 0;
				bottom: 0;
			}
			
			.tmpl-router-active {
				color: #fff;
				background-color: #2E75B2;
			}
			
			.background-white {
				background-color: white;
			}
			
			.view {
				overflow: auto;
				margin-top: 64px;
			}
			
			#detailed {
				position: fixed;
				top: 0;
				left: 0;
				background-color: rgba(0, 0, 0, 0.7);
				width: 100%;
				height: 100%;
				color: #fff;
			}
		</style>

		<div id="app">
			<div style="height:38px;display: none;" id="d"></div>
			<ul class="reset-ul row t-c background-white" id="top">
				<li class="col-xs-2">
					<a href="#/tm1?a=2&b=3" class="tmpl-router reset-a on-get-tmpl block pd-10">tm1</a>
				</li>
				<li class="col-xs-2">
					<a href="#/tm2?a=4&b=1" class="tmpl-router reset-a on-get-tmpl block pd-10">tm2</a>
				</li>
				<li class="col-xs-2">
					<a href="#/tm3?a=4&b=12" class="tmpl-router reset-a on-get-tmpl block pd-10">tm3</a>
				</li>
				<li class="col-xs-2">
					<a href="#/tm8" class="tmpl-router reset-a on-get-tmpl block pd-10">tm8</a>
				</li>
				<li class="col-xs-2">
					<a href="#/tm9?a=1" class="tmpl-router reset-a on-get-tmpl block pd-10">tm9</a>
				</li>
				<li class="col-xs-2">
					<a href="#/tm10" class="tmpl-router reset-a on-get-tmpl block pd-10">tm10</a>
				</li>
			</ul>
		</div>

		<script type="text/template" id="tmp4">
			<div class="row view">
				123
			</div>
		</script>

		<!--详情查看-->
		<div id="detailed" style="display: none;" class="on-close"></div>

		<!--路由显示容器-->
		<div id="tmpl-router-view" class="row">

		</div>

		<script src="src/js/_require.js" type="text/javascript" charset="utf-8"></script>
		<script src="src/js/tmpl.js" type="text/javascript" charset="utf-8"></script>
		<script src="src/js/tmpl-router.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			_require.config({
				baseUrl: '/',
				alias: {
					'tjs': './tmpl/tmpl-js'
				},
				paths: []
			});

			_require.use(function() {

				var Tmpl = _require('tmpl');
				var TmplRouter = _require('tmpl-router');

				Tmpl.install(TmplRouter);
				router = new TmplRouter({
					keepLive: true,
					data: {
						a: 1
					},
					methods: {

					},
					router: {
						'/tm1': {
							tmplUrl: "./php/get_tmpl.php?tmpl=tmpl1",
							alias: '/tm2/tm2-2/tm2-2-1',
							keepLive: true,
							modules: {
								'/tm1-1': {
									tmplUrl: "./php/get_tmpl.php?tmpl=tmpl1",
									alias: '/tm1/index',
									modules: {
										'/tm1-1-1': {
											modules: {
												'/a': {}
											}
										},
										'/tm1-1-2': {}
									}
								},
								'/tm1-2': {
									modules: {
										'/tm1-2-1': {},
										'/tm1-2-2': {}
									}
								},
							}
						},
						'/tm2': {
							tmplUrl: "./php/get_tmpl.php?tmpl=tmpl2",
							alias: '/',
							keepLive: false,
							modules: {
								'/tm2-1': {
									modules: {
										'/tm2-1-1': {},
										'/tm2-1-2': {}
									}
								},
								'/tm2-2': {
									modules: {
										'/tm2-2-1': {},
										'/tm2-2-2': {}
									}
								},
							}
						},
						'/tm3': {
							tmplUrl: "./php/get_tmpl.php?tmpl=tmpl3",
							alias: '/tm6'
						},
						'/tm6': {
							cb: function(hash, viewEl, el) {
								console.log(this, hash);
							}
						},
						'/tm8': {
							tmplId: "tmp4",
							alias: '/tm9'
						},
						'/tm9': {},
						'/tm10': {
							tmplUrl: "./php/get_tmpl.php?tmpl=tmpl2"
						}
					},
					error: function() {
						var _this = this;
						console.log('error');
						setTimeout(function() {
							_this.redirect('/');
						}, 1000);
					},
					routerEnter:function(path,viewEl){
						console.log('跳转中。。。');
					},
					/*hash更新后的钩子*/
					routerEntered: function(path, viewEl, el) {
						var _this = this;
						console.log(path, viewEl, el);
					},
					mounted: function() {}
				});

				app = new Tmpl({
					methods: {
						showDetailed: function(event, el) {
							var content = this.html(el);
							var wrap = this.fn.getEl('detailed');
							this.html(wrap, content);
							this.toggle(wrap);
						},
						close: function(el) {
							this.toggle(el);
						}
					},
					events: function() {
						this.on(document, 'on-show-detailed', 'click', this.showDetailed);
						this.on(document, 'on-close', 'click', this.showDetailed);
					}
				})
			});
		</script>
	</body>

</html>