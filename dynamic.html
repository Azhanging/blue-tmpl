<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="src/css/component.css" />
		<script src="http://libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
	</head>

	<body>
		<style type="text/css">
			#top {
				position: fixed;
				left: 0;
				top: 0;
			}
			
			#bottom {
				position: fixed;
				left: 0;
				bottom: 0;
			}
			
			.tmpl-router-active {
				color: #fff;
				background-color: #2E75B2;
			}
			
			.background-white {
				background-color: white;
			}
			
			.view {
				position: fixed;
				top: 38px;
				height: 95%;
				left: 0;
				overflow: auto;
				z-index: -1;
				padding-bottom: 64px;
			}
			
			#detailed {
				position: fixed;
				top: 0;
				left: 0;
				background-color: rgba(0, 0, 0, 0.7);
				width: 100%;
				height: 100%;
				color: #fff;
			}
		</style>

		<div id="app">
			<div style="height:38px;display: none;" id="d"></div>
			<ul class="reset-ul row t-c background-white" id="top">
				<li class="col-xs-4">
					<a href="#tm1" view="tmp1" class="tmpl-router reset-a on-get-tmpl block pd-10">tm1</a>
				</li>
				<li class="col-xs-4">
					<a href="#tm2" view="tmp2" class="tmpl-router reset-a on-get-tmpl block pd-10">tm2</a>
				</li>
				<li class="col-xs-4">
					<a href="#tm3" view="tmp3" class="tmpl-router reset-a on-get-tmpl block pd-10">tm3</a>
				</li>
			</ul>
		</div>

		<!--详情查看-->
		<div id="detailed" style="display: none;" class="on-close"></div>

		<div id="view" class="row">
			<div class="row view" id="tmp1" style="display: none;">
				<h3>tm1</h3>
				<div class="content">

				</div>
				<div class="row pd-10 t-c">
					<button class="g-btn g-btn-primary g-btn-radius on-add-tm1">add</button>
				</div>
			</div>

			<div class="row view" id="tmp2" style="display: none;">
				<h3>tm2</h3>
				<div class="content">

				</div>
				<div class="row pd-10 t-c">
					<button class="g-btn g-btn-danger g-btn-radius on-add-tm2">add</button>
				</div>
			</div>

			<div class="row view" id="tmp3" style="display: none;">
				<h3>tm3</h3>
				<div class="content">

				</div>
				<div class="row pd-10 t-c">
					<button class="g-btn g-btn-success g-btn-radius  on-add-tm3">add</button>
				</div>
			</div>
		</div>

		<div class="row">
			<ul class="reset-ul row t-c background-white" id="bottom">
				<li class="col-xs-4">
					<a href="#tm1" view="tmp1" class="tmpl-router reset-a on-get-tmpl block pd-10">tm1</a>
				</li>
				<li class="col-xs-4">
					<a href="#tm2" view="tmp2" class="tmpl-router reset-a on-get-tmpl block pd-10">tm2</a>
				</li>
				<li class="col-xs-4">
					<a href="#tm3" view="tmp3" class="tmpl-router reset-a on-get-tmpl block pd-10">tm3</a>
				</li>
			</ul>
		</div>
		<script src="src/js/_require.js" type="text/javascript" charset="utf-8"></script>
		<script src="src/js/tmpl.js" type="text/javascript" charset="utf-8"></script>
		<script src="src/js/tmpl-router.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			_require.config({
				baseUrl: '/',
				paths: [
					'/src/js/tmpl.js',
					'/src/js/tmpl-router.js'
				]
			});

			_require.use(function() {
				
				var Tmpl = _require('tmpl');
				var TmplRouter = _require('tmpl-router');
				
				Tmpl.install(TmplRouter);
				var router = new TmplRouter({
					data: {
						a: 1
					},
					methods: {
						getTmpl: function(tm, viewEl) {
							var _this = this;
							var tmpl = this.tmpl;
							if(tmpl.hasId(tm)) return this;
							$.ajax({
								async: false,
								url: './php/get_tmpl.php?tmpl=' + tm,
								success: function(data) {
									tmpl.append(viewEl, tmpl.create(data.tmpl)).cb(function(){											
										_require.use(function(){
											_require(tm)();
										});
									});
								}
							});
						}
					},
					router: {
						'#tm1': function(el, viewEl) {
							this.getTmpl('tmpl1', viewEl);
						},
						'#tm2': function(el, viewEl) {
							this.getTmpl('tmpl2', viewEl);
						},
						'#tm3': function(el, viewEl) {
							this.getTmpl('tmpl3', viewEl);
						}
					},
					mounted: function() {
						this.hashChange();
					}
				});

				new Tmpl({
					methods: {
						showDetailed: function(event, el) {
							var content = this.html(el);
							var wrap = this.fn.getEl('detailed');
							this.html(wrap, content);
							this.toggle(wrap);
						},
						close: function(el) {
							this.toggle(el);
						}
					},
					events: function() {
						this.on('on-show-detailed', 'click', this.showDetailed);
						this.on('on-close', 'click', this.showDetailed);
					}
				})
			});
		</script>
	</body>

</html>