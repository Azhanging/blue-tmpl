/**
*
*
* tmpl-router.js v1.0.0
* (c) 2016-2017 Blue
* https://github.com/azhanging/tmpl
* Released under the MIT License.
*
*
**/
!function(t,r){"function"==typeof _require?_require.defineId("tmpl-router",r):t?t.TmplRouter=r():{}}("undefined"!=typeof window?window:this,function(){function t(t){this.init(t)}function r(){var t=this;this.routerStatus=!0;var r=m.getEls(this.config.routerLink);m.each(r,function(r,e){m.on(r,"click",function(r){t.routerStatus||r.preventDefault()})})}function e(t,r){var i=this,o=r?r:"";m.each(t,function(t,r){i.router[o+r]=t,m.isObj(t.modules)&&e.apply(i,[t.modules,o+r])})}function i(t,r,e){var i=this,o=null,a=r.hash,h=r.hash,c="";m.each(t,function(t,r){var l=v.attr(t,"href").replace("#","").split("?"),f=l[0],p=l[1]?l[1]:"";f===h?(i.currentRouter=f,a=l.join("?"),c=p,o=t,i.getTmpl(t,h),g&&s.call(i,g),u.apply(i,[f,e]),v.addClass(t,i.config.activeClassName),g=h,i.config.keepLive&&i.router[f].keepLive?n.call(this,i.router[f].scrollTop):n.call(this,0)):(i.router[f]&&s.call(i,f),v.removeClass(t,i.config.activeClassName)),o||(i.currentRouter=h),i.router[f]&&(i.router[f].path={path:l.join(""),hash:f,search:p})}),m.run(this.config.routerEntered,this,[{path:a,hash:h,search:c},e,o])}function o(){var t=this;this.config.keepLive&&m.on(window,"scroll",function(r){t.router[t.currentRouter]&&t.router[t.currentRouter].keepLive&&(t.router[t.currentRouter].scrollTop=document.body.scrollTop||document.documentElement.scrollTop)})}function n(t){if(!m.isNum(t))return 0;try{document.body.scrollTop=parseFloat(t)}catch(r){document.documentElement.scrollTop=parseFloat(t)}}function s(t){var r=this;m.each(r.router[t].view,function(e,i){r.router[t].temp.appendChild(e)}),this.router[t].view=[]}function u(t,r){var e=this;r.appendChild(this.router[t].temp),m.each(v.children(r),function(r,i){e.router[t].view.push(r)})}function a(t,r,e){var i=this.alias[t.hash];return this.router[t.hash]&&(m.run(this.config.routerEnter,this,[t,r,e]),void 0!==this.router[t.hash].routerStatus&&(this.routerStatus=!0),m.run(this.config.routerEntered,this,[t,r,e])),this.alias[i]?a.apply(this,[t,r,e]):i}function h(t){m.each(t.childNodes,function(t,r){3===t.nodeType&&""===t.textContent.trim()&&v.remove(t)})}function c(t){var r=this;this.alias={},m.each(t,function(t,e){var i=t.alias;r.router[e].view=[],void 0===r.router[e].keepLive&&(r.router[e].keepLive=!0),r.router[e].temp=document.createDocumentFragment(),i&&(r.alias[i]=e)})}function l(){var t=this;window.hasTmplRouter||m.on(window,"hashchange",function(r){window.location.hash;t.hashChange(),v.preventDefault(r)})}function f(t){var r=this,e=this.config[t];m.isObj(e)&&m.each(e,function(t,e){r[e]=t})}var p={created:function(){},routerLink:"tmpl-router",activeClassName:"tmpl-router-active",routerView:"tmpl-router-view",data:{},methods:{},error:function(){}},d=null,v=null,m=null,g=null;return t.install=function(r){return this.installed?t:(this.installed=!0,d=r,v=new d({}),void(m=v.fn))},window.Tmpl&&t.install(Tmpl),t.prototype={constructor:t,init:function(t){this.config=m.extend(m.copy(p),t),this.router={},e.call(this,this.config.router?this.config.router:{}),this.tmpl=v,f.call(this,"methods"),f.call(this,"data"),r.call(this),o.call(this),c.call(this,this.router),l.call(this),this.hashChange(),m.run(this.config.mounted,this)},set:function(t){var r=this;return m.isObj(t)&&m.each(t,function(t,e){r.router[e]=t}),c.call(this,t),this},hashChange:function(){var t=window.location.hash.replace("#","").split("?"),r=t[0],e=t[1],o=m.getEls(this.config.routerLink),n=m.getEl(this.config.routerView);if(""===r&&(r="/"),this.alias[r]&&(r=a.apply(this,[{path:t.join(""),hash:r,search:e},n,null])),0===o.length)return this;if(!this.alias[r]&&!this.router[r])return void this.config.error.call(this);var s={path:t.join(""),hash:r,search:e};m.run(this.config.routerEnter,this,[s,n]),void 0!==this.router[r].routerStatus&&(this.routerStatus=!0),i.apply(this,[o,s,n])},go:function(t){m.isNum(t)&&history.go(t)},redirect:function(t){t=t.replace("#","");var r=location.href.split("#");"/"===t?location.href=r[0]:(r[1]=t,location.href=r.join("#"))},getTmpl:function(t,r){var e=this;if(!(!this.router[r]||this.router[r].temp.childNodes.length>0||this.router[r].view.length>0)){var i=this.router[r].tmplUrl,o=this.router[r].tmplId;i?v.fn.ajax({async:!1,url:i,success:function(t){e.router[r].temp.appendChild(v.create(t.tmpl)),h.call(this,e.router[r].temp),e.routerStatus=!1},error:function(t){e.routerStatus=!0}}):o&&(e.router[r].temp.appendChild(v.create(v.html(m.getEl(o)))),e.routerStatus=!0)}},query:function(t){if(!m.isStr(e))return{};var r={},e=t.split("&");return m.each(e,function(t,e){var i=t.split("=");if(1!==i.length){var o=i[0],n=i[1];r[o]=n}}),r},search:function(t,r){var e=v.attr(t,"href").split("?");return r?(m.isObj(r)&&(r=m.serialize(r)),e[1]=r,v.attr(t,{href:e.join("?")}),void 0):e[1]},getHash:function(t){var r="";return r=t.indexOf("#")===-1?t.split("?"):t.replace("#","").split("?"),r[0]}},t.version="v1.0.0",t});